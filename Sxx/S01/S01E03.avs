Import("../../common.avsi")

# Allience release (better bitrate) and the missing section from Koch's, cut to match Koch's audio track

c1 = MPEG2Source("..\..\S01(Alliance)\D03\title_t00.d2v",cpu=4)
#c2 = MPEG2Source("..\..\S01(Koch)\D03\title_t00p1.d2v",cpu=4).Letterbox(0,0,2,2)

# nothing to replace so far... only a placeholder

Trim(c1, 35, 169633) #+ Trim(c2, , ) + Trim(c1, , -0) 

# head rolling

fix1 = FixSlowMoI(131286, 131353, 37900, pd = 2, f = [ \
	[0,1,3,5,6,8,10,11,13,14,16,17,19,20,22,24,26,27,29,30,32,33,35,36,38,39,41,43,45,46,48,49,51,52,54,55,57,59,60,62,64,65,67], \
	[0,1,3,4,6,7,9,10,12,14,16,17,19,20,22,23,25,26,28,29,31,33,35,36,38,39,41,42,44,45,47,49,50,52,54,55,57,58,60,61,63,64,66] \
	])
	
# giant Wist

_fix2 = FixSlowMoI(145655, 145696, 32000, pd = 2, f = [ \
	[0,2,4,5,6,8,9,10,11,12,14,15,17,19,20,21,23,24,25,27,28,29,30,32,33,34,35,37,38,39,40], \
	[0,2,3,4,6,7,8,9,11,12,13,14,17,18,19,21,22,23,24,26,27,28,29,31,32,33,34,36,37,38,39] \
	])
	
fix2 = FixSlowMoI(145655, 145696, 30000, pd = 2, f = [ \
	[0,1,3,3,4,5,8,7,10,9,12,13,16,15,18,17,20,19,22,23,24,25,28,27,30,29,33,33,34,35,38,37,40,39,42,43,46,45,48,47,50,49,54,53,56,55,58,57,60,59,64,63,66,65,68,67,70,69,74,73,76,75,78,77,80,79,83,83], [], \
	[0,3,4,6,8,10,12,14,16,18,20,22,24,27,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,67] \
	]) \
	.Trim(0, 145696 - 145655) # 1 frame longer, drop it, it's also a half frame without field pair
	
# Kai jumping into a hole

fix3 = FixSlowMoI(162702, 162763, 37900, pd = 2, f = [ \
	[1,2,4,5,7,8,10,11,13,15,16,18,20,21,23,24,26,27,29,30,32,34,35,37,39,40,42,43,45,46,48,49,51,53,54,56,58,59,61], \
	[0,1,3,5,6,8,10,11,13,14,16,17,19,20,22,24,25,27,29,30,32,33,35,36,38,39,41,43,44,46,48,49,51,52,54,55,57,58,60] \
	])

# Zev's leg and a funny plant rope (single field)

#fix4 = FixSlowMoI(50847, 50892, 47000, pd = 0, fin = 46, f = [ \
fix4 = FixSlowMoI(50847, 50892, 37300, fin = 46, f = [ \
	[0,1,2,3,4,7,8,9,11,13,14,16,17,19,21,22,23,26,27,28,29,32,33,34,36,38,39,41,42,44], \
	[0,1,2,3,4,7,8,9,11,13,14,16,17,19,21,22,23,26,27,28,29,32,33,34,36,38,39,41,42,44] \
	])

# the green dots are coming for Zev

fix5 = FixSlowMoI(51573, 51603, 30000, f = [ \
	[0,2,3,4,5,6,8,9,10,11,12,14,15,17,18,19,20,21,22,24,25,26,28,29,30], \
	[0,1,2,3,4,6,7,8,9,11,12,13,14,16,17,18,19,21,22,23,24,26,27,28,29] \
	])

# first conveyor belt scene (side sync, amazingly this also makes mid row go in sync)

#fix6 = FixSlowMoI(3645, 3659, 53000, pd = 0, f = [ \
fix6 = FixSlowMoI(3645, 3659, 41500, f = [ \
	[0,2,3,5,7,8,10,12,13], \
	[0,1,3,5,6,8,10,12,13] \
	])

# swamp lady #1

fix7 = FixSlowMoI(142338, 142441, 37900, f = [ \
	[1,2,4,5,7,8,10,11,13,15,16,18,20,21,23,24,26,27,29,30,32,33,35,37,38,40,42,43,45,46,48,49,51,52,54,55,57,58,60,62,63,65,67,68,70,71,73,74,76,77,79,80,82,84,85,87,89,90,92,93,95,96,98,99,101,102], \
	[0,2,3,5,7,8,10,11,13,14,16,17,19,20,22,24,25,27,29,30,32,33,35,36,38,39,41,42,44,45,47,49,50,52,54,55,57,58,60,61,63,64,66,67,69,70,72,74,76,77,79,80,82,83,85,86,88,89,91,92,94,96,97,99,101,102] \
	])

# swamp lady #2

fix8 = FixSlowMoI(142775, 142872, 45300, f = [ \
	[1,2,5,6,8,10,12,14,16,18,20,21,24,25,27,29,31,33,35,37,39,40,43,44,46,48,50,52,54,56,58,59,62,63,65,67,69,71,73,75,77,78,81,82,84,86,88,90,92,94,96,97], \
	[0,2,4,6,8,9,12,13,16,17,19,21,23,25,27,28,31,32,35,36,38,40,42,44,46,47,50,51,54,55,57,59,61,63,65,66,69,70,73,74,76,78,80,82,84,85,88,89,92,93,95,97] \
	])
	
# Zev in the intro

fix9 = FixSlowMoI(6154, 6207, 32800, fin = 7, f = [ \
	[0,1,2,3,5,6,7,9,10,12,13,14,15,17,18,21,23,24,25,26,28,29,31,32,33,34,36,37,39,40,42,43,44,45,47,48,50,51,52,53], \
	[0,1,2,3,4,6,7,8,10,11,12,14,15,17,18,19,22,23,25,26,27,29,30,31,33,34,36,37,38,39,41,42,44,45,46,48,49,50,52,53] \
	])

# His Shadow going up on the column (one frame longer than needed, don't stretch, just remove the last)
	
fix10 = FixSlowMoI(8076, 8107, 30000, pd = 0, deint = 3, f = [ \
	[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,14,16,15,19,19,20,21,23,23,24,25,27,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,46,48,47,50,50,52,51,55,55,56,57,59,59,60,61,62,63], [], \
	[0,2,4,6,8,10,12,15,16,19,20,23,24,27,28,30,32,34,36,38,40,42,44,47,48,51,52,55,56,59,60,62] \
	]).Trim(0, 8107 - 8076)

# moth flying towards the building

fix11 = FixSlowMoI(41064, 41248, 33000, f = [ \
	[1,3,4,5,6,8,9,11,12,13,14,16,17,19,20,22,23,24,25,27,28,30,31,32,34,35,36,38,39,41,42,43,44,46,47,49,50,51,53,54,55,57,58,60,61,62,63,65,66,68,69,71,72,73,74,76,77,79,80,81,83,84,85,87,88,90,91,92,93,95,96,98,99,100,102,103,104,106,107,109,110,111,112,114,115,117,118,120,121,122,123,125,126,128,129,130,132,133,134,136,137,139,140,141,142,144,145,147,148,149,151,152,153,155,156,158,159,160,161,163,164,166,167,169,170,171,172,174,175,177,178,179,180,182,183], \
	[0,2,3,5,6,7,9,10,11,13,14,16,17,18,19,21,22,24,25,26,28,29,30,32,33,35,36,37,38,40,41,43,44,46,47,48,49,51,52,54,55,56,58,59,60,62,63,65,66,67,68,70,71,73,74,75,77,78,79,81,82,84,85,86,87,89,90,92,93,95,96,97,98,100,101,103,104,105,107,108,109,111,112,114,115,116,117,119,120,122,123,124,126,127,128,130,131,133,134,135,136,138,139,141,142,144,145,146,147,149,150,152,153,154,156,157,158,160,161,163,164,165,166,168,169,171,172,173,175,176,177,179,180,182,183] \
	])
	
# Zev in the oven (right number of frames)

fix12 = FixSlowMoI(104993, 105077, 30000, pd = 0, f = [ \
	[0,1,2,3,5,5,6,7,8,9,10,11,12,12,14,13,16,17,18,18,20,19,22,21,24,25,28,27,30,29,32,33,36,35,37,37,38,39,40,41,43,43,44,45,46,47,48,49,50,50,52,51,54,55,56,56,58,57,60,59,62,63,66,65,67,67,68,69,70,71,73,73,74,75,76,77,78,79,81,81,82,83,84,85,86,87,88,88,90,89,92,93,94,94,96,95,98,97,100,101,104,103,105,105,106,107,108,109,111,111,112,113,114,115,116,117,118,118,119,119,120,121,122,123,124,125,126,126,128,127,130,131,132,132,134,133,136,135,138,139,142,141,143,143,144,145,146,147,149,149,150,151,152,153,154,155,156,156,158,157,160,161,162,162,164,163,166,165,168,169], [], \
	[0,2,5,6,8,10,13,14,16,19,20,22,24,26,28,30,32,35,36,38,41,42,44,46,49,50,52,55,56,58,60,62,65,66,68,71,72,74,76,79,80,82,84,87,88,90,93,94,96,98,100,103,104,106,109,110,112,114,117,119,120,122,124,127,128,130,133,134,136,138,140,143,144,146,149,150,152,154,157,158,160,163,164,166,168] \
	])

# crazy Stanley on the bridge (also the right number of frames! the last one is a dup of the first from the next segment)

fix13 = FixSlowMoI(148335, 148434, 30000, pd = 3, deintf = 1, f = [ \
	[0,1,3,3,4,5,8,7,10,9,12,13,14,15,18,17,20,19,22,23,24,25,28,27,30,29,32,33,36,35,38,37,40,39,42,43,46,45,48,47,50,49,52,53,54,55,58,57,60,59,62,63,66,65,68,67,70,69,72,73,74,75,78,77,80,79,82,83,84,85,88,87,90,89,92,93,94,95,98,97,100,99,104,103,106,105,108,107,110,109,114,113,116,115,118,117,120,119,122,123,124,125,128,127,130,129,132,133,134,135,138,137,140,139,142,143,144,145,148,147,150,149,154,153,156,155,158,157,160,159,164,163,166,165,168,167,170,169,174,173,176,175,178,177,180,179,184,183,186,185,188,187,190,189,194,193,196,195,198,197,199,199], [], \
	[0,3,4,7,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,39,41,42,44,46,48,51,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,83,85,87,89,91,92,94,96,98,100,102,104,106,108,110,112,114,116,119,121,123,125,127,129,131,133,135,137,139,141,143,145,147,149,151,153,155,157,158,161] \
	]).Trim(0, 148434 - 148335)

# Zev after the burial looking into the distance

_fix14 = FixSlowMoI(37282, 37374, 30000, pd = 0, fc = 10, deint4 = true, f = [ \
	[1,1,0,0,6,3,8,9], [], \
	[3,6,8,12] \
	]).Trim(0, 37374 - 37281)
#	[1,3,4,6], \
	
# stretch the first part of the scene to full lengths? feels a bit too slow motion

__fix14 = FixSlowMoI(37138, 37279, 50000, pd = 2, fc = 5, f = [ \
	[0,2,3,4], \
	[0,1,2,4] \
	])
	
fix14 = Trim(37138, 37374)

# spinning scenes

# 65 -> 61 -4
#fix15 = FixSlowMoI(75264, 75324, 28500, pd = 0, f = [ \
fix15 = FixSlowMoI(75264, 75324, 30000, pd = 0, f = [ \
	[0,1,2,3,4,5,6,6,8,7,10,10,12,11,14,13,16,15,18,17,20,19,21,21,22,23,25,25,26,27,28,29,30,31,32,33,34,35,36,36,38,37,40,40,42,41,44,44,46,45,48,47,50,49,52,51,54,53,55,55,56,57,59,59,60,61,62,63,64,65,66,67,68,69,70,70,72,71,74,74,76,75,78,77,80,79,82,81,84,83,85,85,86,87,89,89,90,91,92,93,94,95,96,97,98,99,100,100,102,101,104,104,106,105,108,107,110,109,112,111,114,113,116,115,118,117,119,119,120,121], [], \
	[0,2,4,7,8,11,12,14,16,18,20,23,24,27,28,30,32,34,36,39,40,43,44,47,48,50,52,54,56,59,60,63,64,66,68,70,72,75,76,79,80,82,84,86,88,91,92,95,96,98,100,102,104,107,108,111,112,114,116,118,120,122,124,127,128] \
	]).Trim(2, length = 75324 - 75264 + 1)
# 52 -> 52 0
fix16 = FixSlowMoI(75325, 75376, 30000, pd = 0, deint4 = true, fc = 30, f = [ \
	[0,1,4,3,5,5,6,7,8,9,11,11,12,13,14,15,16,17,18,18,20,19,22,23,24,24,26,25,28,27], [], \
	[0,4,11,12,16,23,24,28,32,38,40,44,50,52,56] \
	])
# 78 -> 73 -5
fix17 = FixSlowMoI(75377, 75449, 30000, pd = 0, f = [ \
	[0,0,2,1,4,3,6,5,7,7,8,9,11,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,26,28,27,30,30,32,31,34,33,36,35,38,37,40,39,41,41,42,43,45,45,46,47,48,49,50,51,52,53,54,55,56,56,58,57,60,60,62,61,64,63,66,65,68,67,70,69,71,71,72,73,75,75,76,77,79,79,80,81,82,83,84,85,86,87,88,89,90,90,92,91,94,94,96,95,98,97,100,99,102,101,104,103,105,105,106,107,109,109,110,111,112,113,114,115,116,117,118,119,120,120,122,121,124,124,126,125,128,127,130,129,132,131,134,133,135,135,136,137,139,139,140,141,143,143,144,145], [], \
	[1,2,4,6,9,10,13,14,16,18,20,22,24,26,29,30,33,34,36,38,40,42,45,46,49,50,52,54,56,58,61,62,65,66,68,70,72,74,77,78,81,82,85,86,88,90,92,94,97,98,101,102,104,106,108,110,113,114,117,118,120,122,124,126,129,130,133,134,136,138,140,142,145,146,149,150,153,154] \
	])
	#.Trim(3, length = 75449 - 75377 + 1)
# 42 -> 46 +4
#fix18 = FixSlowMoI(75494, 75539, 33000, pd = 0, deint = 1, deint4 = true, f = [ \
fix18 = FixSlowMoI(75494, 75539, 30000, pd = 0, deint4 = true, f = [ \
	[0,1,2,2,4,3,6,7,8,9,11,11,12,13,14,15,16,17,20,19,21,21,22,23,24,25,28,27,30,29,32,33,36,35,38,37,40,41,42,42,44,43,46,45,48,49,50,51,53,53,54,55,56,57,58,59,62,61,63,63,64,65,66,67,70,69,72,71,74,75,78,77,80,79,82,83,84,84,86,85,88,87,90,91], [], \
	[0,6,8,12,16,23,24,28,32,36,43,44,48,52,56,60,64,68,72,78,80,84,88,92,99,100,104,108,112,119,120,124,128,132,136,140,144,148,154,156,160,164] \
	])
# 28 -> 30 +2	
fix19 = FixSlowMoI(75540, 75569, 30000, pd = 0, deint4 = true, f = [ \
	[0,1,2,3,4,5,8,7,9,9,10,11,12,13,16,15,18,17,20,21,24,23,26,25,28,29,30,30,32,31,34,33,36,37,38,39,40,40,42,41,44,45,46,47,49,49,50,51,52,53,54,55,58,57,59,59], [], \
	[0,4,8,12,19,20,24,28,32,36,40,44,48,54,56,60,64,68,74,76,80,84,91,92,96,100,104,111] \
	])
fix19 = fix19 + fix19.Trim(fix19.FrameCount - 1, length = 1)

# fix17 isn't made shorter and fix18/19 aren't made longer (only by 1 frame), length changes will cancel out

# TODO: few more spinning

#return fix13 # ShowFields

Trim(0, 3644) + \
fix6 + \
Trim(3660, 6153) + \
fix9 + \
Trim(6208, 8075) + \
fix10 + \
Trim(8108, 37137) + \
fix14 + \
Trim(37375, 41063) + \
fix11 + \
Trim(41249, 50846) + \
fix4 + \
Trim(50893, 51572) + \
fix5 + \
Trim(51604, 75263) + \
fix15 + \
fix16 + \
fix17 + \
Trim(75450, 75493) + \
fix18 + \
fix19 + \
Trim(75570, 104992) + \
fix12 + \
Trim(105078, 131285) + \
fix1 + \
Trim(131354, 142337) + \
fix7 + \
Trim(142442, 142774) + \
fix8 + \
Trim(142873, 145654) + \
fix2 + \
Trim(145697, 148334) + \
fix13 + \
Trim(148435, 162701) + \
fix3 + \
Trim(162764, 0)
